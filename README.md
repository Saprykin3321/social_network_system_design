# social_network_system_design
System Design education (may 2025)
System Design социальной сети для курса по System Design

---

# Требования к системе

## Функциональные требования:
1. Публикация постов
    1. Возможность прикрепить фотографии
    2. Возможность оставить описание
    3. Возможность оставить гео-метку
2. Оценка постов других пользователей
3. Комментарии постов других пользователей
4. Подписка на обновления других пользователей
5. Поиск популярных мест для путешествий
6. Просмотр постов
7. Просмотр ленты других пользователей в обратном хронологическом порядке
8. Просмотр своей ленты в обратном хронологическом порядке

## Нефункциональные требования
1. DAU – 10 000 000 в сутки
2. Только для стран СНГ
3. Система должна работать в мобильных устройствах и браузерах
4. Система должна быть надежной
5. Активность пользователей:
    1. Пользователи постят 2 поста в день с 1 фотографией
    2. Пользователи просматривают чужие и свою ленты 10 раз в день (1 лента = 10 постов)
    3. Пользователи оценивают 15 постов в день
    4. Пользователи оставляют 3 комментария в день
6. Требования к посту:
    1. Текст не более 2000 символов с возможностью указывать эмодзи
7. Требования к изображениям:
    1. Одно изображение должно весить не более 500 КБ
    2. В случае превышения размера необходимо сжимать изображение до 500 КБ
8. Сезонность:
    1. Лето
    2. Зима
9. Тайминги:
    1. Публикация одного поста - 2 секунды
    2. Получение ленты новостей - 2 секунды

---

# Расчет нагрузки и трафика

## Нагрузка на запись
* **Посты**: RPS (write) = DAU * 2 поста в день / 86400 = 250 
* **Оценки**: RPS (write) = DAU * 15 оценок в день / 86400 = 1736
* **Комментарии**: RPS (write) = DAU * 3 комментария в день / 86400 = 347
* **Общая оценка**: 250 + 1736 + 347 ~ 2300

## Трафик на запись
* **Посты**: Traffic (write) = RPS * (4016 байт + 500 КБ) * 2 поста в день = 252 MB/s
* **Оценки**: Traffic (write) = RPS * 33 байт * 15 оценок = 860 KB/s
* **Комментарии**: Traffic (write) = RPS * 2032 байт * 3 коммента в день = 2 MB/s
* **Общая оценка**: 255 MB/s

## Нагрузка на чтение
* **Ленты постов**: RPS (read) = DAU * 100 постов / 86400 = 11574

## Трафик на чтение
* **Ленты постов**: Traffic (read) = RPS * (4016 байт (текст) + 500 КБ (картинка) + 2 байта (общие оценки) + 2 байта (общее кол-во комментов)) байт * 10 объектов = 58.3 GB/s

---

# Модель данных

Модель данных доступна по ссылке

## Объем хранимых данных согласно модели
Один объект post занимает 4016 байт 
Один объект image занимает 92 байта
Одно изображение занимает 500 КБ
Одна оценка занимает 33 байта
Один комментарий занимает 2032 байт

Подробности расчетов:
post: 16 байт (ID) + 16 байт (User_ID) + 4000 байт (description с учетом смайликов и русскоязычных символов) + 8 байт (latitude) + 8 байт (longitude) + 8 байт (created_at) + 8 байт (updated_at) = 4064 байт
image: 16 байт (ID) + 16 байт (post_id) + 60 байт (image_url) = 92 байта
review: 16 байт (ID) + 16 байт (post_id) + 1 байт (grade) = 33 байта
comment: 16 байт (ID) + 16 байт (post_id) + 2000 байт (comment с учетом смайликов и русскоязычных смиволов) = 2032 байт 

# Расчет объема хранилища на 1 год

## Расчет хранилища для изображений:

* 1 фотография: 500 КБ
* В день один пользователь постит 2 фотографии: 500 КБ * 2 = 1 МБ
* В день для всех пользователей: DAU * 1 МБ = 10 ТБ
* В год для всех: 10 ТБ * 365 = 3.65 ПТ

## Расчет хранилища для метаданных

**Посты**: 
* Один пост занимает 4016 байт
* В день пользователь публикует 2 поста: 4016 байт * 2 = 9032 байт
* В день для всех пользоателей: DAU * 9 КБ = 90 ГБ
* В год для всех: 90 ГБ * 365 = 32.8 ТБ

**Изображения**:
* Один изображение (мета) занимает 92 байта
* В день пользователь публикует 2 изображения: 92 байт * 2 = 184 байт
* В день для всех пользоателей: DAU * 184 байт = 1.8 ГБ
* В год для всех: 1.8 ГБ * 365 =  657 ГБ

**Оценки**:
* Одна оценка (мета) занимает 33 байта
* В день пользователь публикует 15 оценок: 33 байт * 15 = 495 байт
* В день для всех пользоателей: DAU * 184 байт = 4.9 ГБ
* В год для всех: 4.9 ГБ * 365 =  1.8 ТБ

**Комментарии**:
* Один комментарий (мета) занимает 2032 байта
* В день пользователь публикует 3 комментария: 2032 байт * 3 = 6.1 КБ
* В день для всех пользоателей: DAU * 184 байт = 61 ГБ
* В год для всех: 4.9 ГБ * 365 =  22 ТБ

Итого в год потребуется: 57.2 ТБ

# Расчет количества дисков

Расчет capacity (емкость): 2 MB/s (запись) * 86400 * 365 = 63 TB

HDD:

Количество iops: 13000 => 100 = 130 disks
Пропускная способность: 3.7 MB/s => 100 mb/s = 1 disk
63 TB => 20 TB = 4 disks

Понадобится:
(HDD) 
(SSD) 4 disks by 20TB